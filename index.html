<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор коммунальных платежей</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">Калькулятор коммунальных платежей</h1>
        
        <div class="mb-4">
            <label for="month" class="mr-2">Месяц:</label>
            <select id="month" class="border rounded p-1">
                <option value="0">Январь</option>
                <option value="1">Февраль</option>
                <option value="2">Март</option>
                <option value="3">Апрель</option>
                <option value="4">Май</option>
                <option value="5">Июнь</option>
                <option value="6">Июль</option>
                <option value="7">Август</option>
                <option value="8">Сентябрь</option>
                <option value="9">Октябрь</option>
                <option value="10">Ноябрь</option>
                <option value="11">Декабрь</option>
            </select>
            <label for="year" class="ml-4 mr-2">Год:</label>
            <input type="number" id="year" class="border rounded p-1" value="2024">
        </div>

        <table class="w-full bg-white shadow-md rounded mb-4">
            <thead>
                <tr class="bg-gray-200">
                    <th class="p-2">Услуга</th>
                    <th class="p-2">Тариф</th>
                    <th class="p-2">Предыдущие показания</th>
                    <th class="p-2">Текущие показания</th>
                    <th class="p-2">Расход</th>
                    <th class="p-2">Сумма</th>
                </tr>
            </thead>
            <tbody>
                <!-- Строки таблицы остаются теми же, но с обновленными классами -->
            </tbody>
        </table>

        <p class="text-xl font-bold mb-4">Итого: <span id="total">0</span></p>

        <div class="flex space-x-2 mb-4">
            <button onclick="saveData()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Сохранить данные
            </button>
            <button onclick="clearData()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                Очистить данные
            </button>
            <button onclick="exportToCSV()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                Экспорт в CSV
            </button>
            <input type="file" id="importCSV" accept=".csv" class="hidden">
            <button onclick="document.getElementById('importCSV').click()" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                Импорт из CSV
            </button>
        </div>

        <div class="mb-4">
            <canvas id="expensesChart"></canvas>
        </div>
    </div>

    <script>
        let currentData = {};

        function calculate() {
            let total = 0;
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(row => {
                // Логика расчета остается прежней
            });
            
            document.getElementById('total').textContent = total.toFixed(2);
            updateChart();
        }

        function saveData() {
            const month = document.getElementById('month').value;
            const year = document.getElementById('year').value;
            const key = `utilityBillData_${year}_${month}`;
            
            // Сохраняем текущие данные
            localStorage.setItem(key, JSON.stringify(currentData));
            alert('Данные сохранены');
        }

        function loadData() {
            const month = document.getElementById('month').value;
            const year = document.getElementById('year').value;
            const key = `utilityBillData_${year}_${month}`;
            
            const data = JSON.parse(localStorage.getItem(key));
            if (data) {
                currentData = data;
                // Заполняем таблицу данными
                // ...
                calculate();
            } else {
                clearData();
            }
        }

        function clearData() {
            // Очистка данных остается прежней
        }

        function exportToCSV() {
            // Логика экспорта остается прежней
        }

        function importFromCSV(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                const lines = csv.split('\n');
                // Парсим CSV и заполняем таблицу
                // ...
                calculate();
            };
            reader.readAsText(file);
        }

        function updateChart() {
            const ctx = document.getElementById('expensesChart').getContext('2d');
            const labels = [];
            const data = [];
            
            document.querySelectorAll('tbody tr').forEach(row => {
                labels.push(row.querySelector('td').textContent);
                data.push(parseFloat(row.querySelector('.total').textContent));
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Расходы',
                        data: data,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        document.getElementById('month').addEventListener('change', loadData);
        document.getElementById('year').addEventListener('change', loadData);
        document.getElementById('importCSV').addEventListener('change', importFromCSV);
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', calculate);
        });

        window.addEventListener('load', () => {
            const currentDate = new Date();
            document.getElementById('month').value = currentDate.getMonth();
            document.getElementById('year').value = currentDate.getFullYear();
            loadData();
        });
    </script>
</body>
</html>
